#!/bin/bash
# üîß –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Dockerfile –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

if [ -z "$1" ]; then
    echo "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: bash UPDATE_DOCKERFILE_ON_SERVER.sh user@server_ip"
    exit 1
fi

SERVER=$1
REMOTE_DIR="/opt/telegram-post-copier"

echo "üì§ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Dockerfile –Ω–∞ $SERVER..."
scp Dockerfile $SERVER:$REMOTE_DIR/

echo ""
echo "üîß –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
ssh $SERVER << 'EOFSERVER'
cd /opt/telegram-post-copier
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker-compose down
echo "üê≥ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞..."
docker-compose build --no-cache
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   docker-compose up -d"
EOFSERVER

echo ""
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  ‚úÖ Dockerfile –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω!                      ‚ïë"
echo "‚ïë                                                            ‚ïë"
echo "‚ïë  –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:                              ‚ïë"
echo "‚ïë    ssh $SERVER                                             ‚ïë"
echo "‚ïë    cd $REMOTE_DIR                                          ‚ïë"
echo "‚ïë                                                            ‚ïë"
echo "‚ïë  –ï—Å–ª–∏ session —Ñ–∞–π–ª –µ—Å—Ç—å:                                   ‚ïë"
echo "‚ïë    docker-compose up -d                                    ‚ïë"
echo "‚ïë                                                            ‚ïë"
echo "‚ïë  –ï—Å–ª–∏ –Ω–µ—Ç (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫):                                 ‚ïë"
echo "‚ïë    bash first-auth.sh                                      ‚ïë"
echo "‚ïë    docker-compose up -d                                    ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
