# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Docker

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: `sqlite3.OperationalError: unable to open database file`

### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è session —Ñ–∞–π–ª–∞ Telegram –∏–∑-–∑–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã):

### 1. **Dockerfile** - –¥–æ–±–∞–≤–ª–µ–Ω –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
```dockerfile
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è appuser (UID 1000)
RUN useradd -m -u 1000 appuser && \
    chown -R appuser:appuser /app

USER appuser
```

### 2. **docker-compose.yml** - –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞:
```yaml
volumes:
  # –í–µ—Å—å —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥ (–¥–ª—è session —Ñ–∞–π–ª–æ–≤)
  - .:/app

# –ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user: "1000:1000"
```

### 3. **docker-entrypoint.sh** - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p /app/temp /app/processed_images /app/logs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ session —Ñ–∞–π–ª
chmod 600 /app/copier_session.session
```

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è):

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p temp processed_images logs
chmod 777 temp processed_images logs
```

### –®–∞–≥ 2: –ü–µ—Ä–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ù–û–í–´–ô –°–ü–û–°–û–ë)

**–í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
bash first-auth.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –í—Ä—É—á–Ω—É—é**
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker-compose build

# –ó–∞–ø—É—Å–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)
docker-compose run --rm copier

# –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∫–æ–¥ –∏–∑ Telegram
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –≤ production

```bash
# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ñ–∞–π–ª—ã:
```bash
ls -la copier_session.session*
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -rw------- (600)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker-compose ps
# STATUS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Up"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
```bash
docker-compose logs --tail=50
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: Your Name
# ‚úÖ –ò—Å—Ö–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª: ...
# ‚úÖ –¶–µ–ª–µ–≤–æ–π –∫–∞–Ω–∞–ª: ...
# üîÅ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down

# 2. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø session —Ñ–∞–π–ª–∞
cp copier_session.session copier_session.session.backup

# 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker-compose build --no-cache

# 4. –ï—Å–ª–∏ session —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d

# 5. –ï—Å–ª–∏ –Ω–µ—Ç - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
bash first-auth.sh
```

---

## üêõ Troubleshooting:

### –ü—Ä–æ–±–ª–µ–º–∞: Permission denied –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ session

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
chmod 777 . 2>/dev/null || sudo chmod 777 .

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞
sudo chown -R 1000:1000 .
```

### –ü—Ä–æ–±–ª–µ–º–∞: Session —Ñ–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose run --rm copier ls -la /app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker-compose run --rm copier whoami
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: appuser

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
docker-compose run --rm copier touch /app/test.txt
docker-compose run --rm copier rm /app/test.txt
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏
docker-compose logs

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker-compose run --rm copier bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
ls -la
env | grep -E "API_ID|API_HASH|SOURCE|TARGET"
python -c "from config import Config; Config.validate()"
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø session —Ñ–∞–π–ª–∞:
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
crontab -e

# –ë—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
0 3 * * * cd /path/to/telegram-post-copier && cp copier_session.session backups/session_$(date +\%Y\%m\%d).session
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
# –í docker-compose.yml: restart: unless-stopped

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
tail -f logs/*.log 2>/dev/null || docker-compose logs -f
```

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ .env –≤ .gitignore
grep ".env" .gitignore

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ session —Ñ–∞–π–ª—ã –≤ .gitignore
grep "*.session" .gitignore

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 600)
ls -la .env copier_session.session
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- [ ] ‚úÖ Dockerfile –æ–±–Ω–æ–≤–ª–µ–Ω (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å appuser)
- [ ] ‚úÖ docker-compose.yml –æ–±–Ω–æ–≤–ª–µ–Ω (volume –∏ user)
- [ ] ‚úÖ docker-entrypoint.sh —Å–æ–∑–¥–∞–Ω
- [ ] ‚úÖ first-auth.sh —Å–æ–∑–¥–∞–Ω
- [ ] ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã (temp, logs, processed_images)
- [ ] ‚úÖ .env —Ñ–∞–π–ª –∑–∞–ø–æ–ª–Ω–µ–Ω
- [ ] ‚úÖ –ü–µ—Ä–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [ ] ‚úÖ Session —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ 600
- [ ] ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω (docker-compose up -d)
- [ ] ‚úÖ –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (–Ω–µ—Ç –æ—à–∏–±–æ–∫)
- [ ] ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –¥–µ–ø–ª–æ—è:

```bash
# –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —Å –Ω—É–ª—è (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)
cd /path/to/telegram-post-copier && \
cp env.example .env && \
nano .env && \
bash first-auth.sh && \
docker-compose up -d && \
docker-compose logs -f
```

---

<div align="center">

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! ‚úÖ**

–¢–µ–ø–µ—Ä—å Docker —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.

</div>

